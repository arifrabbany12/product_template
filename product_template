<!-- Custom Shopify Product Template with Progress Bar and Scroll-to-Switch Image Effect -->
<section id="MainProduct" class="product-main">
  <!-- COLUMN 1: Composition & Care Section (33%) -->
  <div class="composition-care">
    <h3 class="section-title">COMPOSITION & CARE</h3>
    <p class="section-text">
      We work with monitoring programmes to ensure compliance with our social, environmental, and health and safety
      standards for our products. To assess compliance, we have developed a programme of audits and continuous
      improvement plans.
    </p>
    <a href="#" class="view-more">View more</a>
  </div>

  <!-- COLUMN 2: Product Image Gallery (33%) -->
  <div class="product-images">
    <!-- Main Image -->
    <div class="image-container">
      {% for image in product.images %}
        <img
          src="{{ image | img_url: '750x' }}"
          alt="{{ image.alt }}"
          class="image {% if forloop.first %}active{% endif %}"
        >
      {% endfor %}
    </div>

    <!-- Thumbnails -->
    <div class="thumbnail-container">
      {% for image in product.images %}
        <img
          src="{{ image | img_url: '100x150' }}"
          alt="{{ image.alt }}"
          class="thumbnail {% if forloop.first %}active{% endif %}"
          data-index="{{ forloop.index0 }}"
        >
      {% endfor %}
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar-container">
      <div class="progress-bar"></div>
    </div>
  </div>

  <!-- COLUMN 3: Dynamic Product Information Section (33%) -->
  <div class="product-info">
    <!-- Dynamic Product Title -->
    <h1 class="product-title">{{ product.title }}</h1>

    <!-- Dynamic Product Price -->
    <h2 class="product-price">
      {{ product.selected_or_first_available_variant.price | money }}
      {% if product.compare_at_price > product.price %}
        <span class="compare-at-price">{{ product.compare_at_price | money }}</span>
      {% endif %}
    </h2>

    <!-- Dynamic Product Description -->
    <p class="product-description">{{ product.description }}</p>

    <!-- Quantity Selector -->
    <label for="quantity" class="quantity-label">Quantity:</label>
    <input type="number" id="quantity" name="quantity" value="1" min="1" class="quantity-input">

    <!-- Dynamic Color Variants -->
    {% if product.options_with_values.size > 0 %}
      <div class="product-variants">
        <h3 class="variant-title">Color</h3>
        <select id="product-color" class="variant-selector">
          {% for option in product.options_with_values %}
            {% if option.name == 'Color' %}
              {% for value in option.values %}
                <option
                  value="{{ value }}"
                  {% if forloop.first %}
                    selected
                  {% endif %}
                >
                  {{ value }}
                </option>
              {% endfor %}
            {% endif %}
          {% endfor %}
        </select>
      </div>
    {% endif %}

    <!-- Dynamic Size Variants -->
    {% if product.options_with_values.size > 0 %}
      <div class="product-variants">
        <h3 class="variant-title">Size</h3>
        <select id="product-size" class="variant-selector">
          {% for option in product.options_with_values %}
            {% if option.name == 'Size' %}
              {% for value in option.values %}
                <option
                  value="{{ value }}"
                  {% if forloop.first %}
                    selected
                  {% endif %}
                >
                  {{ value }}
                </option>
              {% endfor %}
            {% endif %}
          {% endfor %}
        </select>
      </div>
    {% endif %}

    <!-- Add to Cart Form -->
    <form method="post" action="/cart/add" id="add-to-cart-form">
      <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" id="product-id-input">

      <!-- Add to Cart Button -->
      <div class="product-buttons">
        <button type="submit" class="add-to-cart-button">Add to Cart</button>
        <button type="button" class="buy-now-button" id="buy-now">Buy Now</button>
      </div>
    </form>

    <!-- Product Inventory Status -->
    {% if product.selected_or_first_available_variant.inventory_management == 'shopify' %}
      <p class="product-inventory">
        {% if product.selected_or_first_available_variant.inventory_quantity > 0 %}
          {{ product.selected_or_first_available_variant.inventory_quantity }} in stock
        {% else %}
          Out of stock
        {% endif %}
      </p>
    {% endif %}
  </div>
</section>

<!-- Script for Scroll-to-Switch Image Effect and Buy Now Button -->
<script>
// Select all images and thumbnails
const images = document.querySelectorAll('.image');
const thumbnails = document.querySelectorAll('.thumbnail');
const progressBar = document.querySelector('.progress-bar');
const imageContainer = document.querySelector('.image-container');
let currentImage = 0;

// Function to update the main image and progress bar
function updateMainImage(index, direction) {
  images.forEach((img, i) => {
    img.style.transition = 'transform 0.5s ease-in-out, opacity 0.5s ease-in-out'; // Apply transition
    img.style.opacity = 0; // Hide all images

    // Apply sliding animation based on direction
    if (direction === 'down') {
      img.style.transform = i === index ? 'translateY(0)' : 'translateY(-100%)';
    } else {
      img.style.transform = i === index ? 'translateY(0)' : 'translateY(100%)';
    }

    // Show the current image
    if (i === index) {
      img.style.opacity = 1;
    }
  });

  // Update the active thumbnail border and opacity
  thumbnails.forEach(thumbnail => {
    thumbnail.style.borderColor = 'transparent'; // Remove the border from all thumbnails
    thumbnail.style.opacity = 0.6; // Set default opacity for all thumbnails
  });
  thumbnails[index].style.borderColor = '#101010'; // Set the border color for the active thumbnail
  thumbnails[index].style.opacity = 1; // Set opacity to 1 for the active thumbnail

  // Update progress bar height based on the image index
  const progressPercentage = ((index + 1) / images.length) * 100;
  progressBar.style.height = `${progressPercentage}%`;
}

// Add scroll event listener to the image container
imageContainer.addEventListener('wheel', (event) => {
  const direction = event.deltaY > 0 ? 'down' : 'up'; // Determine scroll direction

  if (direction === 'down') {
    currentImage = (currentImage + 1) % images.length; // Go to next image
  } else {
    currentImage = (currentImage - 1 + images.length) % images.length; // Go to previous image
  }

  updateMainImage(currentImage, direction); // Update the image based on scroll and direction

  // Prevent scrolling on the rest of the page when scrolling in the image area
  event.preventDefault();
});

// Add event listener to each thumbnail for click behavior
thumbnails.forEach((thumbnail, index) => {
  thumbnail.addEventListener('click', () => {
    const direction = index > currentImage ? 'down' : 'up'; // Determine direction based on thumbnail click
    currentImage = index; // Set current image index based on clicked thumbnail
    updateMainImage(currentImage, direction); // Update the main image
  });
});

// Initialize: Set the first thumbnail as active and update progress bar
updateMainImage(currentImage, 'down');

// Buy Now button functionality
document.getElementById('buy-now').addEventListener('click', function() {
  const productId = document.getElementById('product-id-input').value;
  const quantity = document.getElementById('quantity').value;

  // Redirect to checkout page with product and quantity pre-filled
  window.location.href = `/checkout?updates[${productId}]=${quantity}`;
});
</script>

<!-- Styles for Product Page -->
<style>
  /* General Layout */
  #MainProduct {
    display: flex;
    justify-content: space-between;
    max-width: 1200px;
    margin: 0 auto;
    gap: 20px;
    overflow: hidden;
    height: 100vh;
  }

  .composition-care, .product-info {
    flex-basis: 25%;
    color: #c7c7c7;
  }

  /* Column 1: Composition & Care */
  .section-title {
    font-size: 24px;
    color: white;
    margin-bottom: 10px;
  }

  .section-text {
    font-size: 16px;
    line-height: 1.6;
  }

  .view-more {
    color: #ff4500;
    font-size: 16px;
  }

  /* Column 2: Product Image Gallery */
  .product-images {
    display: flex;
    align-items: flex-start;
    gap: 20px;
    position: relative;
    width: 50%;
    overflow:hidden;
  }

  .image-container {
    width: 100%;
    position: relative;
    background-color: #000;
  }

  .image {
    width: 100%;
    height: auto;
    position: absolute;
    top: 0;
    left: 0;
    opacity: 0;
    transform: translateY(100%);
    transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out;
  }

  .image.active {
    opacity: 1;
    transform: translateY(0);
  }

  .thumbnail-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .thumbnail {
    cursor: pointer;
    object-fit: cover;
    width: 40px;
    height: 60px;
    border-radius: 5px;
    opacity: 0.6; /* Default opacity for inactive thumbnails */
    border: 1px solid transparent;
    transition: opacity 0.3s ease-in-out, border-color 0.3s ease-in-out;
  }

  .progress-bar-container {
    position: absolute;
    top: 0;
    width: 1px;
    height: 780px;
    background-color: #ddd;
    border-radius: 3px;
    right: 48px;
  }

  .progress-bar {
    width: 100%;
    height: 0;
    background-color: #121212;
    transition: height 0.5s ease-in-out;
    display: inherit !important;
  }

  /* Column 3: Product Information */
  .product-title {
    font-size: 24px;
    color: black;
    margin-bottom: 10px;
  }

  .product-price {
    font-size: 22px;
    color: black;
    margin-bottom: 15px;
  }

  .compare-at-price {
    text-decoration: line-through;
    color: red;
    margin-left: 10px;
  }

  .product-description {
    font-size: 16px;
    color: #c7c7c7;
    margin-bottom: 20px;
  }

  /* Variants Section */
  .variant-title {
    font-size: 16px;
    color: white;
    margin-bottom: 5px;
  }

  .variant-selector {
    padding: 10px;
    background-color: #333;
    color: white;
    border: 1px solid #666;
    cursor: pointer;
    width: 100%;
    margin-bottom: 15px;
  }

  .variant-selector option {
    color: black;
  }

  /* Quantity Section */
  .quantity-label {
    font-size: 16px;
    color: white;
    margin-bottom: 5px;
  }

  .quantity-input {
    padding: 10px;
    width: 100%;
    margin-bottom: 20px;
    background-color: #333;
    color: white;
    border: 1px solid #666;
  }

  /* Add to Cart and Buy Now Buttons */
  .product-buttons {
    display: flex;
    gap: 10px;
  }

  .add-to-cart-button, .buy-now-button {
    padding: 15px 30px;
    background-color: #ff4500;
    color: white;
    border: none;
    cursor: pointer;
    font-size: 16px;
    flex: 1;
    text-align: center;
  }

  .add-to-cart-button:hover, .buy-now-button:hover {
    background-color: #e63e00;
  }
</style>
